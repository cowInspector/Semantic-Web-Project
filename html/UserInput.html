<html>
  <head>
  	<select id="yearSelect" onChange="getUserInput()">
  	  <option value="1992" selected="selected">1992</option>
  	  <option value="1993">1993</option>
  	  <option value="1994">1994</option>
  	  <option value="1995">1995</option>
  	  <option value="1996">1996</option>
  	  <option value="1997">1997</option>
  	  <option value="1998">1998</option>
  	  <option value="1999">1999</option>
  	  <option value="2000">2000</option>
  	  <option value="2001">2001</option>
  	  <option value="2002">2002</option>
  	  <option value="2003">2003</option>
  	  <option value="2004">2004</option>
  	  <option value="2005">2005</option>
  	  <option value="2006">2006</option>
  	  <option value="2007">2007</option>
  	  <option value="2008">2008</option>
  	  <option value="2009">2009</option>
  	  <option value="2010">2010</option>
  	  <option value="2011">2011</option>
  	  <option value="2012">2012</option>
  	</select>
  <br>
  <br>
  <script type='text/javascript' src='https://www.google.com/jsapi'></script>
  	<script type='text/javascript'>
  	google.load('visualization', '1', {packages:['corechart']});
  	google.setOnLoadCallback(drawLineChart);
  	function getUserInput() {
  		var e = document.getElementById("yearSelect");
  		var strUser = e.options[e.selectedIndex].value;
  		var lineChartQueryURL = "http://logd.tw.rpi.edu/sparql.php?query-option=text&query=PREFIX+conversion%3A+%3Chttp%3A%2F%2Fpurl.org%2Ftwc%2Fvocab%2Fconversion%2F%3E%0D%0ASELECT+fn%3Aconcat%28%22%28%22%2Csubstr%28%3Fdate%2C5%2C2%29%2C%22%29%22%29+as+%3Fyear%2C+%28xsd%3Adecimal%28%3Frate%29%29+as+%3Frate%0D%0AFROM+%3Chttp%3A%2F%2Flogd.tw.rpi.edu%2Fsource%2Fdata-gov%2Fdataset%2F861%2Fversion%2F2011-Dec-16%3E%0D%0AWHERE+{%0D%0A++%3Fs+%3Chttp%3A%2F%2Flogd.tw.rpi.edu%2Fsource%2Fdata-gov%2Fdataset%2F861%2Fvocab%2Fraw%2Fdate%3E+%3Fdate%3B%0D%0A+++++%3Chttp%3A%2F%2Flogd.tw.rpi.edu%2Fsource%2Fdata-gov%2Fdataset%2F861%2Fvocab%2Fraw%2Fdollars_per_barrel%3E+%3Frate.%0D%0AFILTER%28substr%28%3Fdate%2C1%2C4%29%3D%22"+strUser+"%22%29%0D%0A}%0D%0AORDER+BY+1&service-uri=&output=gvds&callback=&tqx=&tp=";
  		//alert(queryURL);
  		var lineChartQuery = new google.visualization.Query(lineChartQueryURL); // Send the query.
        lineChartQuery.send(handleLineChartQueryResponse);

        var pieChartQueryURL = "http://logd.tw.rpi.edu/sparql.php?query-option=text&query=PREFIX+conversion%3A+%3Chttp%3A%2F%2Flogd.tw.rpi.edu%2Fsource%2Fdata-gov%2Fdataset%2F5413%2Fvocab%2Fenhancement%2F1%2F%3E%0D%0ASELECT+substr%28%3Fdate%2C1%2C3%29+as+%3Fmonth+%2C+%28sum%28xsd%3Adecimal%28%3Falgeria%29%29+%2B+sum%28xsd%3Adecimal%28%3Fangola%29%29+%2B+sum%28xsd%3Adecimal%28%3Fecuador%29%29+%2B+sum%28xsd%3Adecimal%28%3Firaq%29%29+%2B+sum%28xsd%3Adecimal%28%3Fkuwait%29%29+%2B+sum%28xsd%3Adecimal%28%3Flibya%29%29+%2B+sum%28xsd%3Adecimal%28%3Fnigeria%29%29+%2B+sum%28xsd%3Adecimal%28%3Fqatar%29%29+%2B+sum%28xsd%3Adecimal%28%3Fsaudi%29%29+%2B+sum%28xsd%3Adecimal%28%3Fuae%29%29%29*30+as+%3Ftotal%0D%0AFROM+%3Chttp%3A%2F%2Flogd.tw.rpi.edu%2Fsource%2Fdata-gov%2Fdataset%2F5413%2Fversion%2F2011-Dec-16%3E%0D%0AWHERE+%0D%0A+{%0D%0A+%3Fs+conversion%3Adate+%3Fdate%3B%0D%0A+++++conversion%3Au_s_imports_from_algeria_of_crude_oil_and_petroleum_products_thousand_barrels_per_day+%3Falgeria%3B%0D%0A+++++conversion%3Au_s_imports_from_angola_of_crude_oil_and_petroleum_products_thousand_barrels_per_day+%3Fangola%3B%0D%0A+++++conversion%3Au_s_imports_from_ecuador_of_crude_oil_and_petroleum_products_thousand_barrels_per_day+%3Fecuador%3B%0D%0A+++++conversion%3Au_s_imports_from_iraq_of_crude_oil_and_petroleum_products_thousand_barrels_per_day+%3Firaq%3B%0D%0A+++++conversion%3Au_s_imports_from_kuwait_of_crude_oil_and_petroleum_products_thousand_barrels_per_day+%3Fkuwait%3B%0D%0A+++++conversion%3Au_s_imports_from_libya_of_crude_oil_and_petroleum_products_thousand_barrels_per_day+%3Flibya%3B%0D%0A+++++conversion%3Au_s_imports_from_nigeria_of_crude_oil_and_petroleum_products_thousand_barrels_per_day+%3Fnigeria%3B%0D%0A+++++conversion%3Au_s_imports_from_qatar_of_crude_oil_and_petroleum_products_thousand_barrels_per_day+%3Fqatar%3B%0D%0A+++++conversion%3Au_s_imports_from_saudi_arabia_of_crude_oil_and_petroleum_products_thousand_barrels_per_day+%3Fsaudi%3B%0D%0A+++++conversion%3Au_s_imports_from_united_arab_emirates_of_crude_oil_and_petroleum_products_thousand_barrels_per_day+%3Fuae%3B%0D%0A+++++conversion%3Au_s_imports_from_venezuela_of_crude_oil_and_petroleum_products_thousand_barrels_per_day+%3Fvenezuala.%0D%0AFILTER+%28%3Fdate+!%3D+%22%22+%26%26+substr%28%3Fdate%2C5%29%3D%22"+strUser+"%22%29%0D%0A}&service-uri=&output=gvds&callback=&tqx=&tp=";

        var pieChartQuery = new google.visualization.Query(pieChartQueryURL); // Send the query.
        pieChartQuery.send(handlePieChartQueryResponse);

  	}
  	function handleLineChartQueryResponse(response) {
    	if (response.isError()) {
           alert('Error in query: ' + response.getMessage() + ' ' + response.getDetailedMessage());
           return;
        }
        var jsonData = response.getDataTable();
        var jsonObj = [];
        var rows = jsonData.getNumberOfRows();
        //alert(rows);
        /*var newdata = new google.visualization.DataTable();
        newdata.addColumn('string', 'Month');
        newdata.addColumn('number', 'Rate');
        //newdata.addColumn('number', 'TBD');
        var month1;
        for (var i = 0; i < rows; i++ )
        {
          var month = jsonData.getValue(i, 0);
          var rate = jsonData.getValue(i, 1);
          //var tbd =  jsonData.getValue(i, 2); // AGI figure uses thousand-dollar unit
          newdata.addRow([month,rate]);
          //month1=month;
          alert(month + ' '+rate);
        }
        //alert(month1);*/

        var lineGraphData = new google.visualization.DataTable(jsonData);

        var chart = new google.visualization.LineChart(document.getElementById('chart_div'));
        chart.draw(jsonData);
    }

    function handlePieChartQueryResponse(response) {
    	if (response.isError()) {
           alert('Error in query: ' + response.getMessage() + ' ' + response.getDetailedMessage());
           return;
        }
        var jsonData = response.getDataTable();
        var jsonObj = [];
        var rows = jsonData.getNumberOfRows();
        //alert(rows);
        /*var newdata = new google.visualization.DataTable();
        newdata.addColumn('string', 'Month');
        newdata.addColumn('number', 'Rate');
        //newdata.addColumn('number', 'TBD');
        var month1;
        for (var i = 0; i < rows; i++ )
        {
          var month = jsonData.getValue(i, 0);
          var rate = jsonData.getValue(i, 1);
          //var tbd =  jsonData.getValue(i, 2); // AGI figure uses thousand-dollar unit
          newdata.addRow([month,rate]);
          //month1=month;
          alert(month + ' '+rate);
        }
        //alert(month1);*/
        var options = {
          title: 'Monthly imports from OPEC Countries',
          is3D: true,
        };


        var lineGraphData = new google.visualization.DataTable(jsonData);

        var chart = new google.visualization.PieChart(document.getElementById('piechart_div'));
        chart.draw(jsonData, options);
    }
  	</script>
  </head>
  <body>
  	<div id='chart_div' style="width:1050px; height:250px"></div>
  	<div id='piechart_div'></div>
  </body>
</html>